<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>♥ 菲菲朕天下專屬 ♥ 賽特II爆分機率房</title>

<style>
/* ================== 基本設定 ================== */
body{
    font-family:"Microsoft JhengHei",Arial,sans-serif;
    margin:0;
    padding:12px;
    color:#fff;
    display:flex;
    justify-content:center;
    min-height:100vh;
    position:relative;
    overflow:hidden;
    background:#000;
}

/* ===== 背景淡入層（關鍵修復） ===== */
body::before{
    content:"";
    position:fixed;
    inset:0;
    background: var(--fade-bg) center/cover no-repeat;
    opacity:0;
    transition:opacity .8s ease;
    z-index:-1;
    animation:bgHeartbeat 10s ease-in-out infinite;
}
body.bg-fade::before{ opacity:1; }

@keyframes bgHeartbeat{
    0%,100%{ background-size:100%; }
    50%{ background-size:105%; }
}

/* ================== 粒子 ================== */
#particles{
    position:fixed;
    inset:0;
    pointer-events:none;
    z-index:-2;
}
.particle{
    position:absolute;
    width:6px;
    height:6px;
    border-radius:50%;
    background:rgba(255,255,255,.6);
    animation:floatParticle linear infinite;
}
@keyframes floatParticle{
    from{transform:translateY(0);opacity:.6}
    to{transform:translateY(-120vh);opacity:0}
}

/* ================== 版面 ================== */
.container{max-width:1000px;width:100%;text-align:center}

h1{
    color:#ff69b4;
    text-shadow:0 0 16px rgba(255,105,180,.8);
}

.buttons{margin:15px 0}

button{
    width:200px;
    margin:6px;
    padding:12px;
    font-size:16px;
    border:none;
    border-radius:16px;
    cursor:pointer;
    color:#fff;
    background:linear-gradient(#ffb6c1,#ff69b4);
}
button:disabled{opacity:.6;cursor:not-allowed}

.loading{color:#ff5555;font-size:22px}
.success{color:#ff69b4;font-size:20px;margin-bottom:10px}

/* ================== 房間 ================== */
.slot-container{
    display:none;
    grid-template-columns:repeat(3,1fr);
    gap:14px;
}
.slot{
    background:rgba(15,15,15,.9);
    border-radius:12px;
    padding:14px;
    display:flex;
    justify-content:space-between;
    opacity:0;
    transform:translateY(20px);
    transition:.4s;
}
.slot.show{opacity:1;transform:none}

.highest{
    border:2px solid #ff85c0;
    box-shadow:0 0 40px rgba(255,133,192,1);
}
.high{
    border:2px solid #fff;
    box-shadow:0 0 15px rgba(255,255,255,.6);
}

/* ================== 進度條 ================== */
#progressContainer{
    width:80%;
    height:16px;
    background:rgba(255,255,255,.2);
    border-radius:12px;
    margin:12px auto;
    display:none;
}
#progressBar{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#ff9cd8,#ff69b4);
}
</style>
</head>

<body>
<div id="particles"></div>

<div class="container">
<h1 id="mainTitle">♥ 菲菲朕天下專屬 ♥ 賽特II爆分機率房</h1>

<div class="buttons">
    <button id="countBtn" onclick="handleRefreshClick()">五分鐘換一次 ♥</button>
    <button onclick="toggleVer()">幫你換版本</button>
</div>

<div id="loading" class="loading">爆分機率計算中… ♥ 0%</div>
<div id="success" class="success" style="display:none;">爆分機率計算完成 ♥</div>
<div id="progressContainer"><div id="progressBar"></div></div>
<div id="slots" class="slot-container"></div>
</div>

<script>
/* ================== 不重複核心引擎 ================== */
let recentRooms = new Set();
let refreshCount = 0;

function randRoom(){
    let r,s=0;
    do{
        r=Math.floor(Math.random()*3000)+1;
        s++; if(s>10000) break;
    }while(recentRooms.has(r));
    return r;
}
/* =================================================== */

let version="II";
let cooldownSeconds=300;
let isCooling=false;
let cooldownTimer=null;

function shuffle(a){return a.sort(()=>Math.random()-.5);}

/* ===== 背景切換 ===== */
function changeBackground(img){
    document.body.style.setProperty("--fade-bg",`url("${img}")`);
    document.body.classList.add("bg-fade");
    setTimeout(()=>document.body.classList.remove("bg-fade"),800);
}

/* ===== 粒子 ===== */
function createParticles(count=50){
    const box=document.getElementById("particles");
    for(let i=0;i<count;i++){
        const p=document.createElement("div");
        p.className="particle";
        p.style.left=Math.random()*100+"%";
        p.style.bottom=Math.random()*100+"%";
        p.style.animationDuration=5+Math.random()*10+"s";
        box.appendChild(p);
    }
}

/* ===== 資料生成 ===== */
function generateData(){
    let arr=[];
    let used=new Set();

    function getRoom(){
        let r,s=0;
        do{
            r=randRoom();
            s++; if(s>10000) break;
        }while(used.has(r));
        used.add(r);
        return r;
    }

    for(let i=0;i<3;i++)
        arr.push({room:getRoom(),rate:85+Math.random()*5|0,type:"highest"});

    for(let i=0;i<7;i++)
        arr.push({room:getRoom(),rate:75+Math.random()*10|0,type:"high"});

    while(arr.length<30)
        arr.push({room:getRoom(),rate:50+Math.random()*25|0,type:""});

    arr.forEach(d=>recentRooms.add(d.room));
    refreshCount++;
    if(refreshCount>=3){recentRooms.clear();refreshCount=0;}

    return [...arr.slice(0,3),...shuffle(arr.slice(3))];
}

/* ===== 顯示 ===== */
function generate(){
    slots.innerHTML="";
    slots.style.display="grid";

    const data=generateData();
    let done=0;

    progressContainer.style.display="block";
    progressBar.style.width="0%";
    loading.style.display="block";
    success.style.display="none";

    data.forEach((d,i)=>{
        const div=document.createElement("div");
        div.className="slot "+d.type;
        div.innerHTML=`<span>第 ${d.room} 房</span><span>${d.rate}%</span>`;
        slots.appendChild(div);

        setTimeout(()=>{
            div.classList.add("show");
            done++;
            const p=done/data.length*100|0;
            loading.innerText=`爆分機率計算中… ♥ ${p}%`;
            progressBar.style.width=p+"%";

            if(done===data.length){
                loading.style.display="none";
                success.style.display="block";
                progressContainer.style.display="none";
            }
        },i*50);
    });
}

/* ===== 操作 ===== */
function handleRefreshClick(){
    if(isCooling) return;
    generate();
    startCooldown();
}

function startCooldown(){
    let remain=cooldownSeconds;
    isCooling=true;
    countBtn.disabled=true;

    cooldownTimer=setInterval(()=>{
        remain--;
        countBtn.innerText=`♥ ${String(remain/60|0).padStart(2,"0")}:${String(remain%60).padStart(2,"0")} ♥`;
        if(remain<=0){
            clearInterval(cooldownTimer);
            isCooling=false;
            countBtn.disabled=false;
            countBtn.innerText="五分鐘換一次 ♥";
        }
    },1000);
}

function toggleVer(){
    version=version==="II"?"I":"II";
    mainTitle.innerText=`♥ 菲菲朕天下專屬 ♥ 賽特${version}爆分機率房`;
    recentRooms.clear();
    refreshCount=0;
    changeBackground(version==="II"?"bg2.jpg":"bg1.jpg");
    generate();
}

/* ===== 啟動 ===== */
window.onload=()=>{
    changeBackground("bg2.jpg");
    createParticles(60);
    generate();
};
</script>
</body>
</html>
